# 启用中断
- STC89C52系列共有3个定时器
- 定时器0的中断允许控制位位于**IE**寄存器

![](../photo/Pasted%20image%2020250818112015.png)
```
// 中断总开关
EA = 1;
// 定时器0中断开关
ET0 = 1;
```
# 选择定时器工作模式
## 计数/定时
- 每个定时器都有一个控制位，用于设置**计数/定时**方式
- 定时器0的控制位是**TMOD**（Timer Mode，定时器模式）寄存器中的**C/T**（Counter/Timer）位
- 定时方式
	- 用于产生精确的时间延迟
	- 脉冲信号为系统时钟信号
- 计数方式
	- 用于统计外部脉冲信号的个数
	- 脉冲信号来自单片机外部引脚

![](../photo/Pasted%20image%2020250818112354.png)
![](../photo/Pasted%20image%2020250818112358.png)
## 工作模式
- 模式0——13位定时/计数器，兼容旧的
	- 需要开发者重新为脉冲计数器设定初始值
	- ![](../photo/Pasted%20image%2020250818113729.png)
- 模式1——16位定时/计数器
	- 需要开发者重新为脉冲计数器设定初始值
	- ![](../photo/Pasted%20image%2020250818113743.png)
- 模式2——8位自动重装载
	- 在脉冲计数器溢出时，自动重新设置初始值
	- ![](../photo/Pasted%20image%2020250818113701.png)
- 模式3——双8位定时/计数器
	- ![](../photo/Pasted%20image%2020250818113848.png)


![](../photo/Pasted%20image%2020250818113933.png)
- 四种工作模式需要两个控制位进行设置
- 两个控制位位于TMOD（Timer Mode，定时器模式）寄存器

| M1 | M0 | 工作模式           |
|----|----|----------------|
| 0  | 0  | 工作模式0（13位）     |
| 0  | 1  | 工作模式1（16位）     |
| 1  | 0  | 工作模式2（8位自动重装载） |
| 1  | 1  | 工作模式3（双8位）     |

## 设置脉冲计数器初始值
![](../photo/Pasted%20image%2020250818114706.png)
- 明确每个计数脉冲的时间
	- 分频可选两种，分别是12分频和6分频，默认是12分频
	- 当前系统的时钟频率为11.0592MHz，也就是11059200Hz
	- 计数脉冲的频率是11059200/12 Hz，因此一个计数脉冲的时间是12/11059200 s，大约是1.08us
- 计算所需脉冲个数
	- 假如定时1ms，需要的脉冲个数应为0.001/(12/11059200)
- 计算脉冲计数器初始值
	- 定时器的初始值应为65536-0.001/(12/11059200)，大约等于64614
```
TL0 = 64614;
TH0 = 64614 >> 8;
```
